# Story 2.3: SAQCC Gas & DOL Integration Services

## Status
Draft

## Story
**As a** multi-trade operations manager,
**I want** verification services for gas installation and electrical professionals through SAQCC Gas and Department of Labour databases,
**so that** verified gas fitters and electricians can issue their respective Certificates of Compliance.

## Acceptance Criteria

1. **SAQCC Gas Integration:** Direct integration with SAQCC Gas database for gas installation professional verification and qualification validation
2. **Department of Labour Integration:** Integration with DOL database for electrical trade test certificates and electrician license verification
3. **Multi-Trade Support:** Unified verification interface supporting gas installation and electrical trade verifications simultaneously
4. **Qualification Validation:** Comprehensive validation of gas appliance certifications, electrical trade categories, and specialization scope
5. **Regulatory Compliance:** Full compliance with gas safety and electrical installation regulations for professional authorization
6. **Unified Caching:** Consolidated caching strategy for all regulatory body responses with appropriate data segregation

## Tasks / Subtasks

- [ ] **Task 1: SAQCC Gas API Client** (AC: 1)
  - [ ] Extend BaseAPIClient for SAQCC Gas-specific endpoints
  - [ ] Research and configure SAQCC Gas API credentials (to be determined)
  - [ ] Implement gas professional verification endpoints
  - [ ] Add SAQCC Gas-specific request/response data models
  - [ ] Configure conservative rate limiting until limits confirmed
  - [ ] Add SAQCC Gas API health checks and monitoring

- [ ] **Task 2: Department of Labour API Client** (AC: 2)
  - [ ] Extend BaseAPIClient for DOL-specific endpoints
  - [ ] Research and configure DOL API credentials (to be determined)
  - [ ] Implement electrical trade test verification endpoints
  - [ ] Add DOL-specific request/response data models
  - [ ] Configure appropriate rate limiting for DOL services
  - [ ] Add DOL API health checks and connectivity monitoring

- [ ] **Task 3: Multi-Trade Verification Service** (AC: 3)
  - [ ] Create unified verification service interface
  - [ ] Implement parallel verification for multiple trade types
  - [ ] Add trade-specific routing and response handling
  - [ ] Create consolidated verification response format
  - [ ] Implement cross-trade validation conflict resolution
  - [ ] Add support for professionals with multiple trade qualifications

- [ ] **Task 4: Gas Installation Qualification Validation** (AC: 4)
  - [ ] Implement SAQCC Gas certificate validation
  - [ ] Add gas appliance category verification (domestic, commercial, industrial)
  - [ ] Validate specialized gas certifications (LPG, natural gas)
  - [ ] Create gas installation authorization scope validation
  - [ ] Implement gas safety compliance checking
  - [ ] Add gas equipment specialization validation

- [ ] **Task 5: Electrical Trade Validation** (AC: 4)
  - [ ] Implement DOL trade test certificate validation
  - [ ] Add electrical license category verification (wireman, electrician)
  - [ ] Validate apprenticeship completion status
  - [ ] Create electrical installation authorization scope
  - [ ] Implement electrical safety compliance checking
  - [ ] Add specialization validation (industrial, domestic, solar)

- [ ] **Task 6: Regulatory Compliance Integration** (AC: 5)
  - [ ] Map gas safety regulations to verification requirements
  - [ ] Implement electrical regulation compliance validation
  - [ ] Add cross-regulatory compliance checking
  - [ ] Create regulation-specific authorization matrices
  - [ ] Implement compliance status monitoring
  - [ ] Add regulatory update notification system

- [ ] **Task 7: Unified Caching & Data Management** (AC: 6)
  - [ ] Extend cache strategy for SAQCC and DOL data
  - [ ] Implement trade-specific cache key patterns
  - [ ] Configure appropriate TTL for each regulatory body
  - [ ] Add cross-trade cache invalidation logic
  - [ ] Implement cache warming for multi-trade professionals
  - [ ] Create cache metrics and monitoring per trade type

- [ ] **Task 8: Integration Testing Suite** (AC: 1, 2, 3)
  - [ ] Create SAQCC Gas mock server for testing
  - [ ] Create DOL mock server for testing
  - [ ] Write integration tests for all verification endpoints
  - [ ] Test multi-trade verification scenarios
  - [ ] Validate regulatory compliance checking
  - [ ] Performance test unified verification service

## Dev Notes

### Previous Story Insights
Stories 2.1 and 2.2 provide the BaseAPIClient foundation and PIRB integration patterns that this story extends for SAQCC Gas and DOL integrations.

### Data Models
From Architecture Document (architecture.md#data-models):

**Professional Credential Extensions:**
```typescript
interface ProfessionalCredential {
  tradeType: 'gas' | 'electrical';
  registrationNumber: string;
  issuingBody: 'SAQCC_GAS' | 'DOL' | 'ECSA';
  expiryDate: Date;
  verificationDate: Date;
  status: 'active' | 'expired' | 'suspended';
}

interface SAQCCGasVerificationResponse {
  registrationNumber: string;
  professionalName: string;
  certificateStatus: 'active' | 'expired' | 'suspended';
  gasCategories: string[];
  applianceSpecializations: string[];
  expiryDate: Date;
  safetyCompliance: boolean;
}

interface DOLVerificationResponse {
  tradeTestNumber: string;
  professionalName: string;
  licenseStatus: 'active' | 'expired' | 'suspended';
  electricalCategories: string[];
  apprenticeshipStatus: 'completed' | 'in_progress';
  specializationScope: string[];
  expiryDate: Date;
}
```

[Source: architecture.md#data-models]

### API Specifications
From Architecture Document (architecture.md#external-apis):

**SAQCC Gas Integration:**
- Purpose: Gas installation professional verification
- Documentation: Request from SAQCC Gas
- Base URL: To be provided
- Authentication: To be determined
- Rate Limits: Unknown - implement conservative limits

**DOL Integration:**
- Purpose: Electrical trade professional verification
- API details: To be determined through government channels

**Integration Notes:**
- Critical for gas COC generation compliance
- Manual verification required until API available
- Conservative rate limiting until limits confirmed

[Source: architecture.md#external-apis]

### Component Specifications
From Architecture Document (architecture.md#components):

**ProfessionalVerificationService Extensions:**
- Multi-regulatory body API integrations
- Consolidated credential caching system
- Cross-trade verification and conflict resolution
- Unified manual verification fallback workflows

[Source: architecture.md#components]

### File Locations
From Architecture Document (architecture.md#unified-project-structure):

**Multi-Trade Integration Files:**
```
apps/api/src/
├── integrations/
│   ├── SAQCCClient.ts
│   ├── DOLClient.ts
│   └── UnifiedVerificationService.ts
├── services/
│   └── VerificationService.ts (extended)
├── types/
│   ├── saqcc.ts
│   └── dol.ts
└── routers/
    └── verification.ts (extended)
```

[Source: architecture.md#unified-project-structure]

### Testing Requirements
From Architecture Document (architecture.md#testing-strategy):

**Integration Testing:**
- Multi-regulatory API integration testing
- Cross-trade verification workflow testing
- Unified caching system testing
- Regulatory compliance validation testing

**Performance Testing:**
- Parallel verification response times
- Multi-trade cache performance
- Concurrent API call handling

[Source: architecture.md#testing-strategy]

### Technical Constraints
From Architecture Document (architecture.md#tech-stack):

**Multi-Trade Considerations:**
- API credential management for multiple regulatory bodies
- Unified authentication approach across different systems
- Cross-regulatory data consistency and validation

**Performance Requirements:**
- Parallel API calls for multi-trade professionals
- Efficient caching strategy for multiple data sources
- Unified response time targets across all integrations

[Source: architecture.md#tech-stack]

### Regulatory Compliance Requirements
From Epic 2 Document (epic-2-professional-verification.md#regulatory-compliance-requirements):

**SAQCC Gas Integration Requirements:**
- Verify gas installation qualifications
- Check certificate validity and categories
- Validate specialized gas appliance certifications
- Monitor professional standing status

**Department of Labour Integration Requirements:**
- Verify electrical trade test certificates
- Validate wireman and electrician licenses
- Check apprenticeship completion status
- Monitor professional registration renewals

[Source: epic-2-professional-verification.md#regulatory-compliance-requirements]

### Testing
Based on Architecture Document (architecture.md#testing-strategy):

**Unit Testing:**
- SAQCCClient and DOLClient method testing
- Multi-trade verification logic testing
- Unified caching system testing
- Regulatory compliance validation testing

**Integration Testing:**
- SAQCC Gas and DOL API integrations
- Cross-trade verification scenarios
- Cache coordination across multiple trade types
- Error handling for multiple API failures

**Testing File Structure:**
```
apps/api/tests/
├── integrations/
│   ├── SAQCCClient.test.ts
│   ├── DOLClient.test.ts
│   └── UnifiedVerificationService.test.ts
├── services/
│   └── VerificationService.test.ts
└── integration/
    ├── saqcc-verification.test.ts
    ├── dol-verification.test.ts
    └── multi-trade-verification.test.ts
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-18 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section is populated by the development agent during implementation*

### Agent Model Used
*Record the specific AI agent model and version used for development*

### Debug Log References
*Reference any debug logs or traces generated during development*

### Completion Notes List
*Notes about the completion of tasks and any issues encountered*

### File List
*List all files created, modified, or affected during story implementation*

## QA Results
*Results from QA Agent QA review of the completed story implementation*