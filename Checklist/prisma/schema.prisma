// Prisma Schema for Checklist App
// Database: PostgreSQL (Supabase)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Form Template - Reusable checklist template
model FormTemplate {
  id          String        @id @default(cuid())
  name        String
  category    String        // vehicle, solar, gas, etc.
  description String
  icon        String?       // emoji or icon identifier
  version     Int           @default(1)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  sections    FormSection[]
  submissions FormSubmission[]

  @@index([category])
  @@map("form_templates")
}

// Form Section - Logical grouping within a template
model FormSection {
  id          String      @id @default(cuid())
  templateId  String
  title       String
  description String?
  order       Int         // Display order within template

  template    FormTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  fields      FormField[]

  @@index([templateId])
  @@map("form_sections")
}

// Form Field - Individual input field
model FormField {
  id          String  @id @default(cuid())
  sectionId   String
  type        String  // text, textarea, number, dropdown, checkbox, date, time, photo, signature
  label       String
  placeholder String?
  helpText    String?
  required    Boolean @default(false)
  order       Int     // Display order within section
  config      Json?   // Type-specific configuration (options, min, max, etc.)

  section     FormSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
  @@map("form_fields")
}

// Form Submission - Completed form instance
model FormSubmission {
  id           String   @id @default(cuid())
  templateId   String
  templateName String   // Denormalized for easier querying
  category     String   // Denormalized
  submittedAt  DateTime @default(now())
  submittedBy  String?  // Future: user ID
  status       String   @default("completed") // draft, completed
  metadata     Json?    // GPS, device info, etc.

  template     FormTemplate @relation(fields: [templateId], references: [id])
  answers      FormAnswer[]

  @@index([templateId])
  @@index([submittedAt])
  @@index([category])
  @@map("form_submissions")
}

// Form Answer - Individual field response
model FormAnswer {
  id           String  @id @default(cuid())
  submissionId String
  fieldId      String  // Reference to FormField (soft reference)
  fieldLabel   String  // Denormalized for PDF generation
  fieldType    String  // Denormalized
  sectionTitle String  // Denormalized for grouping
  value        Json?   // Flexible value storage (string, number, boolean, array)
  photoUrls    String[] // Future: uploaded photo URLs

  submission   FormSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  @@index([submissionId])
  @@map("form_answers")
}
